import{a as b,r,j as e,C as w,u as T,T as k,F as E,V as I,b as A,S as L,c as U,A as N,B as O,G,d as D}from"./vendor-3dd8369e.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function l(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=l(s);fetch(s.href,n)}})();const v="https://33yang.github.io/taichi-cop-testing/",S="983a25ae4aded4c93d38",B="8e6c91a1eeb00bf55c5faba1dfd1bbdb68822188",M=`https://github.com/login/oauth/authorize?client_id=${S}&redirect_uri=${v}&scope=user`,z=`/api/login/oauth/access_token?client_id=${S}&client_secret=${B}`,F="https://github.com/33YANG/taichi-cop-testing";async function H(c){try{const o=await b({method:"POST",url:`${z}&code=${c}`,headers:{Accept:"application/json"}}),{error:l,error_description:i}=o==null?void 0:o.data;if(l){console.error(i),window.location.href=v;return}const{access_token:s}=o==null?void 0:o.data;return s}catch(o){console.error(o)}}async function $(c){try{const o=await b({method:"GET",url:"https://api.github.com/user",headers:{accept:"application/json",Authorization:`token ${c}`}});return o==null?void 0:o.data}catch(o){console.error(o)}}function K(c){const{setUserInfo:o,setLoading:l}=c,i=async s=>{l(!0);const n=await H(s);localStorage.setItem("access_token",n||null);const a=await $(n);o(a),localStorage.setItem("user_info",JSON.stringify(a)),console.log("user_info",a),l(!1)};return r.useEffect(()=>{const s=localStorage.getItem("access_token"),n=new URLSearchParams(window.location.search).get("code");if(s){const a=JSON.parse(localStorage.getItem("user_info"));console.log("[ user_info ]",a),a!=null&&a.id?o(a):(localStorage.removeItem("access_token"),localStorage.removeItem("user_info"),window.location.href=v)}else n&&i(n)},[]),e.jsx(e.Fragment,{})}function Y(c){const[o,l]=r.useState(c.text),[i,s]=r.useState({x:0,y:0}),[n,a]=r.useState("#cccccc"),[u,p]=r.useState(!1),[h,x]=r.useState([]),[g,f]=r.useState([]);r.useEffect(()=>{l(c.text)},[c.text]);const _=t=>{x([...h,{text:o,position:i,color:n,isRotate:u}]),l(t),f([])},m=t=>{x([...h,{text:o,position:i,color:n,isRotate:u}]),s(t),f([])},R=t=>{x([...h,{text:o,position:i,color:n,isRotate:u}]),a(t),f([])},P=t=>{x([...h,{text:o,position:i,color:n,isRotate:u}]),p(t),f([])},d=()=>{const t=h[h.length-1];console.log("[ prev ]",h,t),t&&(x(h.slice(0,-1)),f([...g,{text:o,position:i,color:n,isRotate:u}]),l(t.text),s(t.position),a(t.color),p(t.isRotate))},j=()=>{const t=g[g.length-1];t&&(console.log("[ prev ]",g,t),f(g.slice(0,-1)),x([...h,{text:o,position:i,color:n,isRotate:u}]),l(t.text),s(t.position),a(t.color),p(t.isRotate))},y=t=>{t.ctrlKey&&t.key==="z"?(console.log("[ undoStack ]",h),d()):t.ctrlKey&&t.key==="y"&&(console.log("[ redoStack ]",g),j())};return r.useEffect(()=>(window.addEventListener("keydown",y),()=>{window.removeEventListener("keydown",y)}),[]),e.jsxs(e.Fragment,{children:[e.jsx(w,{children:e.jsx(J,{position:i,text:o,color:n,isRotate:u,onPositionChange:m,onMouseEnter:()=>console.log("Mouse enter"),onMouseLeave:()=>console.log("Mouse leave")})}),e.jsx(V,{text:o,position:i,color:n,isRotate:u,onIsRotateChange:P,onTextChange:_,onPositionChange:m,onColorChange:R,onUndo:d,onRedo:j,canUndo:h.length>0,canRedo:g.length>0})]})}function J(c){const o=r.useRef(),[l,i]=r.useState(!1),[s,n]=r.useState(null),{position:a,text:u,color:p,onMouseEnter:h,onMouseLeave:x,isRotate:g,onPositionChange:f}=c,{camera:_}=T();_.position.set(0,0,5);const m=r.useCallback(t=>{let C=new k(u,{font:t,size:1,height:.3});C.center(),n(C)},[u]);r.useEffect(()=>{new E().load("https://threejs.org/examples/fonts/gentilis_regular.typeface.json",m)},[m]);const R=r.useCallback(t=>{t.stopPropagation()},[]),P=r.useCallback(t=>{if(t.stopPropagation(),l){const C=new I(a.x+t.movementX,a.y-t.movementY,0);o.current.position.copy(C),f(C)}},[l,a,f]),d=r.useCallback(t=>{t.stopPropagation()},[]),j=r.useCallback(()=>{},[h]),y=r.useCallback(()=>{i(!1)},[x]);return A((t,C)=>{g&&(o.current.rotation.y+=C*.3)}),e.jsx("mesh",{position:[a.x,a.y,0],onPointerDown:t=>{i(!0),R(t)},onPointerMove:P,onPointerUp:t=>{i(!1),d(t)},onPointerOver:j,onPointerOut:y,geometry:s,ref:o,children:e.jsx("meshBasicMaterial",{attach:"material",color:p})})}function V(c){const{text:o,position:l,color:i,onTextChange:s,onPositionChange:n,onColorChange:a,onUndo:u,onRedo:p,canUndo:h,canRedo:x,onIsRotateChange:g,isRotate:f}=c,_=d=>{s(d.target.value)},m=(d,j)=>{const y={...l,[j]:parseFloat(d.target.value)};n(y)},R=d=>{a(d)},P=d=>{g(d.target.checked)};return e.jsxs("div",{className:"control-panel",children:[e.jsx("h3",{children:"Control Panel"}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Text "}),e.jsx("input",{type:"text",value:o,onChange:_})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"Rotate "}),e.jsx("input",{type:"checkbox",checked:f,onChange:P,style:{marginRight:"15px"}}),e.jsx("label",{children:"Color "}),e.jsx("input",{type:"color",value:i,onChange:d=>R(d.target.value),style:{marginRight:"20px"}})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("label",{children:"X-axis "}),e.jsx("input",{type:"number",step:"0.1",value:l.x,onChange:d=>m(d,"x"),style:{width:"120px",marginRight:"10px"}}),e.jsx("label",{children:"Y-axis "}),e.jsx("input",{type:"number",step:"0.1",value:l.y,onChange:d=>m(d,"y"),style:{width:"120px"}})]}),e.jsxs("div",{className:"control-item",children:[e.jsx("button",{onClick:u,disabled:!h,style:{marginRight:"5px"},children:"Undo"}),e.jsx("button",{onClick:p,disabled:!x,children:"Redo"})]})]})}function W(){const[c,o]=r.useState({name:"Hello World"}),[l,i]=r.useState(!1),s=()=>{console.log("userInfo",c),window.location.href=(c==null?void 0:c.html_url)||""},n=()=>{window.location.href=F},a=()=>{window.location.href=M};return e.jsx("main",{children:e.jsxs(L,{spinning:l,size:"large",children:[e.jsxs("header",{children:[e.jsxs("div",{className:"title",children:[e.jsx(U,{style:{fontSize:"20px"}}),e.jsx("span",{children:"3D Editor"})]}),e.jsxs("div",{className:"right-info",children:[e.jsx("div",{className:"user-docs",onClick:n,children:"Documents"}),c.id?e.jsxs("div",{className:"user-info",onClick:s,title:c.name,children:[e.jsx(N,{size:32,src:e.jsx("img",{src:c.avatar_url,alt:"avatar"})}),e.jsx("span",{className:"name",children:c.name})]}):e.jsx("div",{className:"login-btn",children:e.jsx(O,{icon:e.jsx(G,{}),size:"small",onClick:a,children:"Login"})})]})]}),e.jsxs("section",{className:"content",children:[e.jsx(Y,{text:c.name}),e.jsx(K,{setUserInfo:o,setLoading:i})]})]})})}D.createRoot(document.getElementById("root")).render(e.jsx(W,{}));
